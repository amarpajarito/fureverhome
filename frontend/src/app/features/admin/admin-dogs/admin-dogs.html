<!-- Admin Header -->
<div class="bg-gradient-to-r from-[#2D6A4F] to-[#1B4332] text-white py-8 shadow-lg">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl md:text-4xl font-bold font-['Poppins']">Manage Dogs</h1>
        <p class="text-gray-200 mt-1">View, edit, and delete dog records</p>
      </div>
      <a
        routerLink="/admin/dogs/new"
        class="inline-flex items-center space-x-2 px-6 py-3 bg-white text-[#2D6A4F] rounded-lg hover:bg-gray-100 transition-colors font-semibold shadow-md"
      >
        <lucide-icon [img]="Plus" [size]="20"></lucide-icon>
        <span>Add New Dog</span>
      </a>
    </div>
  </div>
</div>

<!-- Content -->
<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Success Message -->
    @if (successMessage) {
    <div
      class="bg-green-50 border-2 border-green-200 rounded-lg p-4 mb-6 flex items-center space-x-3 animate-fade-in"
    >
      <lucide-icon [img]="CheckCircle" [size]="20" class="text-green-600"></lucide-icon>
      <p class="text-green-800 font-medium">{{ successMessage }}</p>
    </div>
    }

    <!-- Search & Filters -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <!-- Search Bar -->
      <div class="relative mb-4">
        <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
          <lucide-icon [img]="Search" [size]="20"></lucide-icon>
        </div>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          placeholder="Search dogs by name or breed..."
          class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2D6A4F] focus:border-transparent"
        />
      </div>

      <!-- Filters Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- Breed Filter -->
        <div>
          <label for="breed-filter" class="block text-sm font-medium text-gray-700 mb-2">
            Breed
          </label>
          <select
            id="breed-filter"
            [(ngModel)]="selectedBreed"
            (change)="onBreedChange()"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2D6A4F] focus:border-transparent"
          >
            <option value="">All Breeds</option>
            @for (breed of breeds; track breed) {
            <option [value]="breed">{{ breed }}</option>
            }
          </select>
        </div>

        <!-- Gender Filter -->
        <div>
          <label for="gender-filter" class="block text-sm font-medium text-gray-700 mb-2">
            Gender
          </label>
          <select
            id="gender-filter"
            [(ngModel)]="selectedGender"
            (change)="onGenderChange()"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2D6A4F] focus:border-transparent"
          >
            <option value="">All Genders</option>
            <option value="MALE">Male</option>
            <option value="FEMALE">Female</option>
          </select>
        </div>

        <!-- Age Filter -->
        <div>
          <label for="age-filter" class="block text-sm font-medium text-gray-700 mb-2">
            Age Range
          </label>
          <select
            id="age-filter"
            [(ngModel)]="selectedAge"
            (change)="onAgeChange()"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2D6A4F] focus:border-transparent"
          >
            <option value="">All Ages</option>
            <option value="puppy">Puppy (< 1 year)</option>
            <option value="young">Young (1-3 years)</option>
            <option value="adult">Adult (4-7 years)</option>
            <option value="senior">Senior (8+ years)</option>
          </select>
        </div>

        <!-- Status Filter -->
        <div>
          <label for="status-filter" class="block text-sm font-medium text-gray-700 mb-2">
            Status
          </label>
          <select
            id="status-filter"
            [(ngModel)]="selectedStatus"
            (change)="onStatusChange()"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2D6A4F] focus:border-transparent"
          >
            <option value="">All Status</option>
            <option value="available">Available</option>
            <option value="adopted">Adopted</option>
          </select>
        </div>
      </div>

      <!-- Clear Filters Button -->
      @if (searchTerm || selectedBreed || selectedGender || selectedAge || selectedStatus) {
      <div class="mt-4">
        <button
          (click)="clearFilters()"
          class="inline-flex items-center space-x-2 px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors"
        >
          <lucide-icon [img]="Filter" [size]="16"></lucide-icon>
          <span>Clear All Filters</span>
        </button>
      </div>
      }
    </div>

    <!-- Loading State -->
    @if (isLoading) {
    <div class="flex justify-center items-center py-20">
      <div class="text-center">
        <div
          class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-[#2D6A4F]"
        ></div>
        <p class="mt-4 text-gray-600">Loading dogs...</p>
      </div>
    </div>
    }

    <!-- Error State -->
    @if (errorMessage && !isLoading) {
    <div class="bg-red-50 border border-red-200 rounded-lg p-6 text-center">
      <lucide-icon [img]="AlertCircle" [size]="48" class="mx-auto text-red-500 mb-4"></lucide-icon>
      <p class="text-red-600 text-lg">{{ errorMessage }}</p>
    </div>
    }

    <!-- Empty State -->
    @if (!isLoading && !errorMessage && filteredDogs.length === 0) {
    <div class="text-center py-20">
      <p class="text-gray-500 text-lg mb-4">
        {{ searchTerm ? 'No dogs found matching your search.' : 'No dogs found.' }}
      </p>
      @if (!searchTerm) {
      <a
        routerLink="/admin/dogs/new"
        class="inline-flex items-center space-x-2 px-6 py-3 bg-[#2D6A4F] text-white rounded-lg hover:bg-[#1B4332] transition-colors font-semibold"
      >
        <lucide-icon [img]="Plus" [size]="20"></lucide-icon>
        <span>Add Your First Dog</span>
      </a>
      }
    </div>
    }

    <!-- Dogs Table -->
    @if (!isLoading && !errorMessage && filteredDogs.length > 0) {
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Image
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Name
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Breed
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Age
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Gender
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Status
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Actions
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            @for (dog of filteredDogs; track dog.id) {
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="h-16 w-16 rounded-lg overflow-hidden bg-gray-200">
                  <img
                    [src]="getDogImageUrl(dog)"
                    [alt]="dog.name"
                    class="h-full w-full object-cover"
                    (error)="
                      $event.target.src =
                        'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect fill=%22%23D1D5DB%22 width=%22100%22 height=%22100%22/%3E%3C/svg%3E'
                    "
                  />
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">{{ dog.name }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-700">{{ dog.breed }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-700">{{ getAgeLabel(dog.age) }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-700">{{ getGenderLabel(dog.gender) }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                @if (dog.available) {
                <span
                  class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"
                >
                  Available
                </span>
                } @else {
                <span
                  class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800"
                >
                  Adopted
                </span>
                }
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <div class="flex items-center justify-end space-x-2">
                  <button
                    (click)="viewDog(dog)"
                    class="text-blue-600 hover:text-blue-900 p-2 hover:bg-blue-50 rounded transition-colors"
                    title="View Details"
                  >
                    <lucide-icon [img]="Eye" [size]="18"></lucide-icon>
                  </button>
                  <a
                    [routerLink]="['/admin/dogs', dog.id, 'edit']"
                    class="text-[#2D6A4F] hover:text-[#1B4332] p-2 hover:bg-green-50 rounded transition-colors"
                    title="Edit"
                  >
                    <lucide-icon [img]="Edit" [size]="18"></lucide-icon>
                  </a>
                  <button
                    (click)="deleteDog(dog)"
                    class="text-red-600 hover:text-red-900 p-2 hover:bg-red-50 rounded transition-colors"
                    title="Delete"
                  >
                    <lucide-icon [img]="Trash2" [size]="18"></lucide-icon>
                  </button>
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

    <!-- Results Count -->
    <div class="mt-4 text-center text-sm text-gray-600">
      Showing {{ filteredDogs.length }} of {{ dogs.length }} dog(s)
    </div>
    }
  </div>
</div>

<!-- View Dog Modal -->
@if (selectedDog) {
<div
  class="fixed inset-0 bg-black bg-opacity-30 z-50 flex items-center justify-center p-4 backdrop-blur-sm"
>
  <div
    class="bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col"
  >
    <!-- Modal Header -->
    <div
      class="bg-gradient-to-r from-[#2D6A4F] to-[#1B4332] text-white p-6 rounded-t-xl flex-shrink-0"
    >
      <div class="flex items-center justify-between">
        <h2 class="text-2xl font-bold">{{ selectedDog.name }}</h2>
        <button (click)="closeModal()" class="text-white hover:text-gray-200 transition-colors">
          <lucide-icon [img]="X" [size]="24"></lucide-icon>
        </button>
      </div>
    </div>

    <!-- Modal Content - Scrollable -->
    <div class="p-6 overflow-y-auto flex-1">
      <!-- Dog Image -->
      <div class="mb-6 rounded-lg overflow-hidden shadow-lg">
        <img
          [src]="getDogImageUrl(selectedDog)"
          [alt]="selectedDog.name"
          class="w-full h-[500px] object-cover object-center"
        />
      </div>

      <!-- Dog Details Grid -->
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="bg-gray-50 p-4 rounded-lg">
          <p class="text-sm text-gray-600 font-medium mb-1">Breed</p>
          <p class="text-lg font-semibold text-gray-800">{{ selectedDog.breed }}</p>
        </div>
        <div class="bg-gray-50 p-4 rounded-lg">
          <p class="text-sm text-gray-600 font-medium mb-1">Age</p>
          <p class="text-lg font-semibold text-gray-800">{{ selectedDog.age }} years old</p>
        </div>
        <div class="bg-gray-50 p-4 rounded-lg">
          <p class="text-sm text-gray-600 font-medium mb-1">Gender</p>
          <p class="text-lg font-semibold text-gray-800">
            {{ selectedDog.gender === 'MALE' ? 'Male' : 'Female' }}
          </p>
        </div>
        <div class="bg-gray-50 p-4 rounded-lg">
          <p class="text-sm text-gray-600 font-medium mb-1">Health Status</p>
          <p class="text-lg font-semibold text-gray-800">{{ selectedDog.healthStatus }}</p>
        </div>
      </div>

      <!-- Description -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Description</h3>
        <p class="text-gray-600 leading-relaxed">{{ selectedDog.description }}</p>
      </div>

      <!-- Availability Status -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Availability</h3>
        @if (selectedDog.available) {
        <span class="inline-block px-4 py-2 bg-green-100 text-green-800 rounded-full font-medium">
          ✓ Available for Adoption
        </span>
        } @else {
        <span class="inline-block px-4 py-2 bg-gray-100 text-gray-800 rounded-full font-medium">
          ✗ Not Available (Adopted)
        </span>
        }
      </div>

      <!-- Created/Updated Info -->
      <div class="grid grid-cols-2 gap-4 text-sm text-gray-500">
        <div>
          <span class="font-medium">Created:</span>
          {{ selectedDog.createdAt | date : 'medium' }}
        </div>
        <div>
          <span class="font-medium">Last Updated:</span>
          {{ selectedDog.updatedAt | date : 'medium' }}
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="mt-6 flex items-center justify-end space-x-3 pt-4 border-t border-gray-200">
        <button
          (click)="closeModal()"
          class="px-6 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium"
        >
          Close
        </button>
        <a
          [routerLink]="['/admin/dogs', selectedDog.id, 'edit']"
          (click)="closeModal()"
          class="px-6 py-2 bg-[#2D6A4F] text-white rounded-lg hover:bg-[#1B4332] transition-colors font-medium"
        >
          Edit Dog
        </a>
      </div>
    </div>
  </div>
</div>
}
