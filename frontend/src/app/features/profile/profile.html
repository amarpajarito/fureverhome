<!-- Profile Page -->
<section class="min-h-screen bg-gray-50 py-12">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Page Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-[#1B4332] font-['Poppins']">My Profile</h1>
      <p class="text-[#6C757D] mt-2">Manage your account settings and preferences</p>
    </div>

    @if (isLoadingProfile()) {
    <div class="bg-white rounded-2xl shadow-lg p-8 text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-[#2D6A4F] mx-auto"></div>
      <p class="text-[#6C757D] mt-4">Loading profile...</p>
    </div>
    } @else {

    <!-- Avatar Section -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mb-6">
      <h2 class="text-xl font-semibold text-[#1B4332] font-['Poppins'] mb-6">Profile Picture</h2>

      <div class="flex flex-col md:flex-row items-center md:items-start gap-6">
        <!-- Avatar Preview -->
        <div class="relative">
          <div
            class="w-32 h-32 rounded-full overflow-hidden bg-gradient-to-br from-[#2D6A4F] to-[#52B788] flex items-center justify-center"
          >
            @if (previewUrl()) {
            <img [src]="previewUrl()" alt="Profile" class="w-full h-full object-cover" />
            } @else {
            <lucide-icon [img]="User" [size]="64" class="text-white"></lucide-icon>
            }
          </div>

          <!-- Camera Icon Button -->
          <label
            for="avatar-upload"
            class="absolute bottom-0 right-0 bg-[#2D6A4F] text-white p-2 rounded-full cursor-pointer hover:bg-[#1B4332] transition-colors duration-200 shadow-lg"
          >
            <lucide-icon [img]="Camera" [size]="20"></lucide-icon>
            <input
              type="file"
              id="avatar-upload"
              accept="image/*"
              (change)="onFileSelected($event)"
              class="hidden"
            />
          </label>
        </div>

        <!-- Upload Info -->
        <div class="flex-1 text-center md:text-left">
          <h3 class="font-semibold text-[#1B4332] mb-2">Update Your Photo</h3>
          <p class="text-sm text-[#6C757D] mb-4">
            Upload a new profile picture. JPG, PNG or GIF. Max size 5MB.
          </p>
          @if (selectedFile()) {
          <p class="text-sm text-[#2D6A4F] font-medium">Selected: {{ selectedFile()!.name }}</p>
          }
        </div>
      </div>
    </div>

    <!-- Profile Information Form -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mb-6">
      <h2 class="text-xl font-semibold text-[#1B4332] font-['Poppins'] mb-6">
        Personal Information
      </h2>

      <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- First Name -->
          <div>
            <label class="block text-sm font-medium text-[#1B4332] mb-2">
              First Name <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <lucide-icon [img]="User" [size]="20" class="text-[#6C757D]"></lucide-icon>
              </div>
              <input
                type="text"
                formControlName="firstName"
                class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2D6A4F] focus:border-transparent transition-all duration-200"
                placeholder="Enter first name"
              />
            </div>
            @if (getFieldError(profileForm, 'firstName')) {
            <p class="text-red-500 text-sm mt-1 flex items-center gap-1">
              <lucide-icon [img]="AlertCircle" [size]="14"></lucide-icon>
              {{ getFieldError(profileForm, 'firstName') }}
            </p>
            }
          </div>

          <!-- Last Name -->
          <div>
            <label class="block text-sm font-medium text-[#1B4332] mb-2">
              Last Name <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <lucide-icon [img]="User" [size]="20" class="text-[#6C757D]"></lucide-icon>
              </div>
              <input
                type="text"
                formControlName="lastName"
                class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2D6A4F] focus:border-transparent transition-all duration-200"
                placeholder="Enter last name"
              />
            </div>
            @if (getFieldError(profileForm, 'lastName')) {
            <p class="text-red-500 text-sm mt-1 flex items-center gap-1">
              <lucide-icon [img]="AlertCircle" [size]="14"></lucide-icon>
              {{ getFieldError(profileForm, 'lastName') }}
            </p>
            }
          </div>

          <!-- Email -->
          <div>
            <label class="block text-sm font-medium text-[#1B4332] mb-2">
              Email <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <lucide-icon [img]="Mail" [size]="20" class="text-[#6C757D]"></lucide-icon>
              </div>
              <input
                type="email"
                formControlName="email"
                class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2D6A4F] focus:border-transparent transition-all duration-200"
                placeholder="Enter email address"
              />
            </div>
            @if (getFieldError(profileForm, 'email')) {
            <p class="text-red-500 text-sm mt-1 flex items-center gap-1">
              <lucide-icon [img]="AlertCircle" [size]="14"></lucide-icon>
              {{ getFieldError(profileForm, 'email') }}
            </p>
            }
          </div>

          <!-- Phone Number -->
          <div>
            <label class="block text-sm font-medium text-[#1B4332] mb-2">
              Phone Number <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <lucide-icon [img]="Phone" [size]="20" class="text-[#6C757D]"></lucide-icon>
              </div>
              <input
                type="tel"
                formControlName="phoneNumber"
                class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2D6A4F] focus:border-transparent transition-all duration-200"
                placeholder="Enter phone number"
              />
            </div>
            @if (getFieldError(profileForm, 'phoneNumber')) {
            <p class="text-red-500 text-sm mt-1 flex items-center gap-1">
              <lucide-icon [img]="AlertCircle" [size]="14"></lucide-icon>
              {{ getFieldError(profileForm, 'phoneNumber') }}
            </p>
            }
          </div>
        </div>

        <!-- Address (Full Width) -->
        <div class="mt-6">
          <label class="block text-sm font-medium text-[#1B4332] mb-2">
            Address <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <div class="absolute top-3 left-3 pointer-events-none">
              <lucide-icon [img]="MapPin" [size]="20" class="text-[#6C757D]"></lucide-icon>
            </div>
            <textarea
              formControlName="address"
              rows="3"
              class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2D6A4F] focus:border-transparent transition-all duration-200 resize-none"
              placeholder="Enter your complete address"
            ></textarea>
          </div>
          @if (getFieldError(profileForm, 'address')) {
          <p class="text-red-500 text-sm mt-1 flex items-center gap-1">
            <lucide-icon [img]="AlertCircle" [size]="14"></lucide-icon>
            {{ getFieldError(profileForm, 'address') }}
          </p>
          }
        </div>

        <!-- Success/Error Messages -->
        @if (profileSuccessMessage()) {
        <div
          class="mt-6 bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg flex items-center gap-2"
        >
          <lucide-icon [img]="CheckCircle2" [size]="20" class="text-green-600"></lucide-icon>
          {{ profileSuccessMessage() }}
        </div>
        } @if (profileErrorMessage()) {
        <div
          class="mt-6 bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg flex items-center gap-2"
        >
          <lucide-icon [img]="AlertCircle" [size]="20" class="text-red-600"></lucide-icon>
          {{ profileErrorMessage() }}
        </div>
        }

        <!-- Submit Button -->
        <div class="mt-6">
          <button
            type="submit"
            [disabled]="isUpdatingProfile()"
            class="w-full md:w-auto px-8 py-3 bg-[#2D6A4F] text-white rounded-lg hover:bg-[#1B4332] transition-colors duration-300 font-semibold flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            @if (isUpdatingProfile()) {
            <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
            <span>Updating...</span>
            } @else {
            <lucide-icon [img]="Save" [size]="20"></lucide-icon>
            <span>Save Changes</span>
            }
          </button>
        </div>
      </form>
    </div>

    <!-- Change Password Section -->
    <div class="bg-white rounded-2xl shadow-lg p-8">
      <h2 class="text-xl font-semibold text-[#1B4332] font-['Poppins'] mb-6">Change Password</h2>

      <form [formGroup]="passwordForm" (ngSubmit)="updatePassword()">
        <div class="space-y-6">
          <!-- Current Password -->
          <div>
            <label class="block text-sm font-medium text-[#1B4332] mb-2">
              Current Password <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <lucide-icon [img]="Lock" [size]="20" class="text-[#6C757D]"></lucide-icon>
              </div>
              <input
                type="password"
                formControlName="currentPassword"
                class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2D6A4F] focus:border-transparent transition-all duration-200"
                placeholder="Enter current password"
              />
            </div>
            @if (getFieldError(passwordForm, 'currentPassword')) {
            <p class="text-red-500 text-sm mt-1 flex items-center gap-1">
              <lucide-icon [img]="AlertCircle" [size]="14"></lucide-icon>
              {{ getFieldError(passwordForm, 'currentPassword') }}
            </p>
            }
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- New Password -->
            <div>
              <label class="block text-sm font-medium text-[#1B4332] mb-2">
                New Password <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <lucide-icon [img]="Lock" [size]="20" class="text-[#6C757D]"></lucide-icon>
                </div>
                <input
                  type="password"
                  formControlName="newPassword"
                  class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2D6A4F] focus:border-transparent transition-all duration-200"
                  placeholder="Enter new password"
                />
              </div>
              @if (getFieldError(passwordForm, 'newPassword')) {
              <p class="text-red-500 text-sm mt-1 flex items-center gap-1">
                <lucide-icon [img]="AlertCircle" [size]="14"></lucide-icon>
                {{ getFieldError(passwordForm, 'newPassword') }}
              </p>
              }
            </div>

            <!-- Confirm Password -->
            <div>
              <label class="block text-sm font-medium text-[#1B4332] mb-2">
                Confirm Password <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <lucide-icon [img]="Lock" [size]="20" class="text-[#6C757D]"></lucide-icon>
                </div>
                <input
                  type="password"
                  formControlName="confirmPassword"
                  class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2D6A4F] focus:border-transparent transition-all duration-200"
                  placeholder="Confirm new password"
                />
              </div>
              @if (getFieldError(passwordForm, 'confirmPassword')) {
              <p class="text-red-500 text-sm mt-1 flex items-center gap-1">
                <lucide-icon [img]="AlertCircle" [size]="14"></lucide-icon>
                {{ getFieldError(passwordForm, 'confirmPassword') }}
              </p>
              } @if (passwordForm.errors?.['mismatch'] &&
              passwordForm.get('confirmPassword')?.touched) {
              <p class="text-red-500 text-sm mt-1 flex items-center gap-1">
                <lucide-icon [img]="AlertCircle" [size]="14"></lucide-icon>
                Passwords do not match
              </p>
              }
            </div>
          </div>
        </div>

        <!-- Success/Error Messages -->
        @if (passwordSuccessMessage()) {
        <div
          class="mt-6 bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg flex items-center gap-2"
        >
          <lucide-icon [img]="CheckCircle2" [size]="20" class="text-green-600"></lucide-icon>
          {{ passwordSuccessMessage() }}
        </div>
        } @if (passwordErrorMessage()) {
        <div
          class="mt-6 bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg flex items-center gap-2"
        >
          <lucide-icon [img]="AlertCircle" [size]="20" class="text-red-600"></lucide-icon>
          {{ passwordErrorMessage() }}
        </div>
        }

        <!-- Submit Button -->
        <div class="mt-6">
          <button
            type="submit"
            [disabled]="isUpdatingPassword()"
            class="w-full md:w-auto px-8 py-3 bg-[#2D6A4F] text-white rounded-lg hover:bg-[#1B4332] transition-colors duration-300 font-semibold flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            @if (isUpdatingPassword()) {
            <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
            <span>Updating...</span>
            } @else {
            <lucide-icon [img]="Save" [size]="20"></lucide-icon>
            <span>Update Password</span>
            }
          </button>
        </div>
      </form>
    </div>
    }
  </div>
</section>
